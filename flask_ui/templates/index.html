<!DOCTYPE html>
<html>
<head>
    <title>Semantic Search App</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <h1>üß† Semantic Search App</h1>

        {% if message %}
            <div class="message{% if "‚ùå" in message %} error{% endif %}">{{ message }}</div>
        {% endif %}

        <div style="text-align:right; margin-bottom: 10px;">
            <a href="/test_image" target="_blank">
                <button type="button" class="btn-search" style="width:auto;">Test Hi·ªÉn Th·ªã ·∫¢nh</button>
            </a>
        </div>

        <div class="form-section">
            <h2>‚ûï Th√™m S·∫£n Ph·∫©m</h2>
            <form method="post" enctype="multipart/form-data">
                <input type="hidden" name="action" value="add">
                <div class="form-group"><input type="text" name="id" placeholder="ID" required></div>
                <div class="form-group"><input type="text" name="name" placeholder="T√™n s·∫£n ph·∫©m" required></div>
                <div class="form-group"><input type="text" name="description" placeholder="M√¥ t·∫£" required></div>
                <div class="form-group"><input type="text" name="category" placeholder="Danh m·ª•c" required></div>
                <div class="form-group"><input type="number" name="price" placeholder="Gi√° (VNƒê)" required></div>
                <div class="form-group"><input type="text" name="brand" placeholder="Th∆∞∆°ng hi·ªáu"></div>
                <div class="form-group"><input type="text" name="color" placeholder="M√†u s·∫Øc"></div>
                <div class="form-group"><input type="text" name="size" placeholder="K√≠ch th∆∞·ªõc"></div>
                <div class="form-group"><input type="text" name="tags" placeholder="Tags (ph√¢n c√°ch b·∫±ng d·∫•u ph·∫©y)"></div>
                <div class="form-group"><label>Ch·ªçn ·∫£nh s·∫£n ph·∫©m:</label><input type="file" name="add_image_file" accept="image/*"></div>
                <button type="submit" class="btn-add">‚ûï Th√™m s·∫£n ph·∫©m</button>
            </form>
        </div>

        <div class="form-section">
            <h2>üîç T√¨m Ki·∫øm S·∫£n Ph·∫©m</h2>
            <div style="margin-bottom: 10px;">
                <span style="font-weight:bold;">M·∫´u t√¨m ki·∫øm nhanh:</span>
                <button type="button" class="btn-search" style="width:auto;" onclick="setSample('T√¥i mu·ªën t√¨m m·ªôt chi·∫øc √°o s∆° mi tr·∫Øng tay d√†i cho nam ph√π h·ª£p ƒëi l√†m.')">T√¥i mu·ªën t√¨m m·ªôt chi·∫øc √°o s∆° mi tr·∫Øng tay d√†i cho nam ph√π h·ª£p ƒëi l√†m.</button>
                <button type="button" class="btn-search" style="width:auto;" onclick="setSample('C√≥ m·∫´u v√°y hoa nh√≠ m√†u xanh d∆∞∆°ng cho m√πa h√® kh√¥ng?')">C√≥ m·∫´u v√°y hoa nh√≠ m√†u xanh d∆∞∆°ng cho m√πa h√® kh√¥ng?</button>
                <button type="button" class="btn-search" style="width:auto;" onclick="setSample('T√¨m gi√∫p t√¥i ƒë√¥i gi√†y th·ªÉ thao m√†u ƒëen size 42 d√†nh cho nam.')">T√¨m gi√∫p t√¥i ƒë√¥i gi√†y th·ªÉ thao m√†u ƒëen size 42 d√†nh cho nam.</button>
                <button type="button" class="btn-search" style="width:auto;" onclick="setSample('I\'m looking for a comfortable pair of blue jeans suitable for daily wear.')">I'm looking for a comfortable pair of blue jeans suitable for daily wear.</button>
                <button type="button" class="btn-search" style="width:auto;" onclick="setSample('Show me some elegant summer dresses with floral patterns for women.')">Show me some elegant summer dresses with floral patterns for women.</button>
                <button type="button" class="btn-search" style="width:auto;" onclick="setSample('Find a classic black leather jacket for men in large size.')">Find a classic black leather jacket for men in large size.</button>
            </div>
            <form method="post" enctype="multipart/form-data">
                <input type="hidden" name="action" value="search">
                <div class="form-group">
                    <input type="text" name="query" id="search_query_input" placeholder="Nh·∫≠p t·ª´ kh√≥a t√¨m ki·∫øm...">
                </div>
                <div class="form-group">
                    <label for="search_type">Lo·∫°i t√¨m ki·∫øm</label>
                    <select name="search_type" id="search_type">
                        <option value="semantic">Semantic</option>
                        <option value="hybrid">Hybrid</option>
                        <option value="image">Image</option>
                    </select>
                </div>
                <div class="form-group" id="image-upload-group" style="display:none;">
                    <label for="image_file">Ch·ªçn ·∫£nh ƒë·ªÉ t√¨m ki·∫øm</label>
                    <input type="file" name="image_file" id="image_file" accept="image/*">
                </div>
                <button type="submit" class="btn-search">üîç T√¨m ki·∫øm</button>
            </form>
        </div>
        <script>
            // Hi·ªán input upload ·∫£nh n·∫øu ch·ªçn search_type = image
            const searchType = document.getElementById('search_type');
            const imageGroup = document.getElementById('image-upload-group');
            if (searchType) {
                searchType.addEventListener('change', function() {
                    if (this.value === 'image') {
                        imageGroup.style.display = '';
                    } else {
                        imageGroup.style.display = 'none';
                    }
                });
            }

            function setSample(text) {
                document.getElementById('search_query_input').value = text;
            }
        </script>

        {% if results %}
            <div class="results">
                <h2>üì¶ K·∫øt Qu·∫£ T√¨m Ki·∫øm</h2>
                <ul>
                    {% for item in results %}
                    <li class="result-item">
                        {% if item.metadata.image_path %}
                            <img src="{{ item.metadata.image_path }}" class="result-image" alt="·∫¢nh s·∫£n ph·∫©m">
                        {% endif %}
                        <div class="result-info">
                            <h3>{{ item.metadata.name }}</h3>
                            <p>{{ item.metadata.description }}</p>
                            <p>
                                <span class="label">Th∆∞∆°ng hi·ªáu:</span> {{ item.metadata.brand or "N/A" }} |
                                <span class="label">Gi√°:</span> {{ item.metadata.price or "N/A" }} |
                                <span class="label">Lo·∫°i:</span> {{ item.metadata.category or "N/A" }} |
                                <span class="label">Score:</span> {{ "%.3f"|format(item.score or item.hybrid_score) }}
                            </p>
                        </div>
                    </li>
                    {% endfor %}
                </ul>
            </div>
        {% endif %}
    </div>
</body>
</html>
